##### База данных «Абитуриент», запросы корректировки

### Содержание
[Повысить итоговые баллы абитуриентов в таблице applicant на значения ИД](#T1)<br>
[Запрос на обновление, UPDATE](#T2)<br>
[Создание таблицы, занесение констант и данные из других таблиц CREATE](#T3)<br>
<br>

<a name="T1"></a>
### Задание

Повысить итоговые баллы абитуриентов в таблице applicant на значения дополнительных баллов (использовать запрос из предыдущего урока).

### Фрагмент логической схемы базы данных:

<img src="ab_7.jpg">

### Структура корректируемой таблицы:

<img src="cx_3_12.jpg">

### Пояснение
1. В запросах на обновление можно использовать несколько связанных таблиц. Например, чтобы обновить поле `itog` таблицы `applicant` для записей, относящихся к образовательной программе «Прикладная механика», используется запрос:

`UPDATE 
    applicant
    INNER JOIN program ON applicant.program_id = program.program_id
SET itog = 2
WHERE name_program = "Прикладная механика";`

2. В нашем случае вместо таблицы program можно использовать вложенный запрос, в котором посчитаны дополнительные баллы абитуриентов. А в качестве условия соединения таблиц после ключевого слова `ON` указать, что `id` абитуриентов в таблице `applicant` и во вложенном запросе совпадают.


```sql
UPDATE applicant a
    LEFT JOIN (
        SELECT enrollee_id, IF(SUM(bonus) IS NULL, 0, SUM(bonus)) AS sum_bonus
            FROM enrollee_achievement
            LEFT JOIN achievement USING(achievement_id)
        GROUP BY 1) B ON a.enrollee_id = B.enrollee_id
SET itog = itog + IF(B.sum_bonus IS NULL, 0, B.sum_bonus);

SELECT * FROM applicant;

+------------+-------------+------+
| program_id | enrollee_id | itog |
+------------+-------------+------+
| 1          | 3           | 235  |
| 1          | 2           | 226  |
| 1          | 1           | 219  |
| 2          | 6           | 276  |
| 2          | 3           | 235  |
| 2          | 2           | 226  |
| 3          | 6           | 270  |
| 3          | 4           | 239  |
| 3          | 5           | 200  |
| 4          | 6           | 270  |
| 4          | 3           | 247  |
| 4          | 5           | 200  |
+------------+-------------+------+

```

