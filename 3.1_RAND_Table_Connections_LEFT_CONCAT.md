## База данных «Тестирование», запросы на выборку

### **Содержание**
 
[Случайным образом отобрать 3 вопроса по определенной дисциплине. RAND()](#T1)<br>
[Вывести вопросы, на которые отвечал определенный студент в определенной попытке, ответ студента и результат (правильно или нет).](#T2)<br>
[Посчитать результаты тестирования для всех попыток.](#T3)<br>
[Для каждого вопроса вывести процент успешных решений и общее количество ответов. LEFT(строка, n), CONCAT(строка_1, строка_2)](#T4)<br>
<br>

<a name="T1"></a>
### Случайным образом отобрать 3 вопроса по определенной дисциплине. RAND()

Случайным образом отберите 3 вопроса по дисциплине «Основы баз данных». В результат включите столбцы question_id и name_question.
<br>Для выбора случайных вопросов можно отсортировать вопросы в случайном порядке:
<br>
`ORDER BY RAND()`

```sql
SELECT question_id, name_question
FROM subject JOIN question USING (subject_id)
WHERE name_subject = 'Основы баз данных'
ORDER BY RAND()
LIMIT 3;

+-------------+-----------------------------------------------------+
| question_id | name_question                                       |
+-------------+-----------------------------------------------------+
| 6           | База данных - это:                                  |
| 9           | Какой тип данных не допустим в реляционной таблице? |
| 7           | Отношение - это:                                    |
+-------------+-----------------------------------------------------+
```
___
<br>

<a name="T2"></a>
### **Вывести вопросы, на которые отвечал определенный студент в определенной попытке, ответ студента и результат (правильно или нет).**

Вывести вопросы, которые были включены в тест для Семенова Ивана по дисциплине «Основы SQL» 2020-05-17  (значение attempt_id для этой попытки равно 7). Указать, какой ответ дал студент и правильный он или нет (вывести Верно или Неверно). В результат включить вопрос, ответ и вычисляемый столбец  Результат.
<br>Для вывода результата используете функцию if().

```sql
SELECT name_question, name_answer, IF(is_correct = 1, 'Верно', 'Неверно') AS Результат
FROM question JOIN testing USING(question_id) JOIN answer USING (answer_id)
WHERE attempt_id = 7;

+----------------------------------------------------------+-----------------------+-----------+
| name_question                                            | name_answer           | Результат |
+----------------------------------------------------------+-----------------------+-----------+
| Запрос на выборку начинается с ключевого слова:          | INSERT                | Неверно   |
| Какой запрос выбирает все записи из таблицы student:     | SELECT * FROM student | Верно     |
| Для внутреннего соединения таблиц используется оператор: | CROSS JOIN            | Неверно   |
+----------------------------------------------------------+-----------------------+-----------+
```
___
<br>

<a name="T3"></a>
### **Посчитать результаты тестирования для всех попыток.**

Посчитать результаты тестирования. Результат попытки вычислить как количество правильных ответов, деленное на 3 (количество вопросов в каждой попытке) и умноженное на 100. Результат округлить до двух знаков после запятой. Вывести фамилию студента, название предмета, дату и результат. Последний столбец назвать Результат. Информацию отсортировать сначала по фамилии студента, потом по убыванию даты попытки.

Пояснение
В запрос не рекомендуется включать таблицу question, нужно связать answer непосредственно с testing. Если же в этом запросе использовать связь testing - question - answer и считать верные ответы, то получится, что считаются ВЕРНЫЕ ответы на вопросы, занесенные в таблицу question, а не верные ответы, которые дал пользователь.
<br>Обратите внимание, таблицы answer и testing имеют 2 общих столбца и если у вас не получится верный с одним столбцом - попробуйте с другим.

<img src="img/cx24.jpg">

```sql
SELECT name_student, name_subject, date_attempt, ROUND((SUM(is_correct) / 3) * 100, 2) AS Результат
FROM answer a
    JOIN testing t ON a.answer_id = t.answer_id
    JOIN attempt USING(attempt_id)
    JOIN student USING(student_id)
    JOIN subject USING(subject_id)
GROUP BY 1, 2, 3
ORDER BY 1, 3 DESC;

+-----------------+-------------------+--------------+-----------+
| name_student    | name_subject      | date_attempt | Результат |
+-----------------+-------------------+--------------+-----------+
| Баранов Павел   | Основы SQL        | 2020-04-15   | 33.33     |
| Баранов Павел   | Основы баз данных | 2020-03-23   | 66.67     |
| Семенов Иван    | Основы SQL        | 2020-05-17   | 33.33     |
| Семенов Иван    | Основы SQL        | 2020-04-15   | 66.67     |
| Семенов Иван    | Основы SQL        | 2020-03-23   | 100.00    |
| Яковлева Галина | Основы баз данных | 2020-04-21   | 100.00    |
| Яковлева Галина | Основы баз данных | 2020-03-26   | 0.00      |
+-----------------+-------------------+--------------+-----------+

```

___
<br>

<a name="T4"></a>
### Для каждого вопроса вывести процент успешных решений и общее количество ответов. LEFT(строка, n), CONCAT(строка_1, строка_2)

Для каждого вопроса вывести процент успешных решений, то есть отношение количества верных ответов к общему количеству ответов, значение округлить до 2-х знаков после запятой. Также вывести название предмета, к которому относится вопрос, и общее количество ответов на этот вопрос. В результат включить название дисциплины, вопросы по ней (столбец назвать Вопрос), а также два вычисляемых столбца Всего_ответов и Успешность. Информацию отсортировать сначала по названию дисциплины, потом по убыванию успешности, а потом по тексту вопроса в алфавитном порядке.

Поскольку тексты вопросов могут быть длинными, обрезать их 30 символов и добавить многоточие "...".

### **Пояснение**

<ol>
<li>Чтобы выделить крайние левые n символов из строки используется функция LEFT(строка, n):

`LEFT("abcde", 3) -> "abc"`</li>
 
<li>Соединение строк осуществляется с помощью функции CONCAT(строка_1, строка_2):

`CONCAT("ab","cd") -> "abcd"`</li>
<li>Поле is_correct - имеет тип BOOLEAN. Если ответ верный (TRUE), то в нем хранится 1, если неверный (FALSE), то в нем хранится 0. Можно заметить, что суммирование этого поля (при верно установленных связях) позволит посчитать количество верных ответов.</li>

<li>Чтобы включить в запрос вопросы,  на которые все пользователи  ответили неверно, используйте операторы внешнего соединения. (Можно придумать и другой способ включения таких вопросов в результат).</li>
</ol>

```sql
SELECT name_subject, CONCAT(LEFT(name_question, 30), "...") AS Вопрос, COUNT(t.question_id) AS Всего_ответов, 
    ROUND(100 * SUM(is_correct) / COUNT(t.question_id), 2) AS Успешность 
FROM subject
    JOIN question USING(subject_id)
    JOIN answer a USING(question_id)
    JOIN testing t ON a.answer_id = t.answer_id 
GROUP BY 1, 2
ORDER BY 1, 4 DESC, 2;

+-------------------+-----------------------------------+---------------+------------+
| name_subject      | Вопрос                            | Всего_ответов | Успешность |
+-------------------+-----------------------------------+---------------+------------+
| Основы SQL        | Условие, по которому отбираютс... | 1             | 100.00     |
| Основы SQL        | Запрос на выборку начинается с... | 4             | 75.00      |
| Основы SQL        | Какой запрос выбирает все запи... | 3             | 66.67      |
| Основы SQL        | Для сортировки используется:...   | 2             | 50.00      |
| Основы SQL        | Для внутреннего соединения таб... | 2             | 0.00       |
| Основы баз данных | База данных - это:...             | 3             | 66.67      |
| Основы баз данных | Какой тип данных не допустим в... | 2             | 50.00      |
| Основы баз данных | Концептуальная модель использу... | 2             | 50.00      |
| Основы баз данных | Отношение - это:...               | 2             | 50.00      |
+-------------------+-----------------------------------+---------------+------------+

```

### **Задание из комментариев на шаге 11.**
<ol>
<li>Всякий студент должен сдать хотя бы один тест либо по основам баз данных либо по SQL. Тест считается сданным, если студент (не важно с какой попытки) выполнил больше 50%, то есть ответил хотя бы на 2 вопроса из трёх.</li>
<li>Те студенты, что не сдали ни одного из предметов (не важно, по не явке или по неуду) должны быть отчислены.</li>
<li>Те студенты, которые получили хотя бы за один тест 100% - должны получить прибавку к стипендии в 100 рублей.</li>
</ol>

```sql
SELECT student.name_student as Студент, 
     IF(M<50 or M is null, 'Отчислить за неуспеваемость',
                IF(M=100, 'Повысить стипендию на 100 рублей', 'Перевести на следующий курс')) as  Решение_Ректората
     FROM student LEFT JOIN  (
         SELECT name_student, MAX(result) as M
         FROM student JOIN attempt USING(student_id)
         WHERE subject_id IN (1, 2)
         GROUP BY 1)G 
     ON student.name_student=G.name_student
     ORDER BY 1;

+-----------------+----------------------------------+
| Студент         | Решение_Ректората                |
+-----------------+----------------------------------+
| Абрамова Катя   | Отчислить за неуспеваемость      |
| Баранов Павел   | Перевести на следующий курс      |
| Семенов Иван    | Повысить стипендию на 100 рублей |
| Яковлева Галина | Повысить стипендию на 100 рублей |
+-----------------+----------------------------------+

```
___
<br>
