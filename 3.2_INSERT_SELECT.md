# База данных «Интернет-магазин книг», запросы корректировки

# Содержание
[Добавление записи в таблицу с использованием INSERT и SELECT](#T1)<br>
[Выбор 3 случайных вопросов для последнего студента. ORDER BY RAND()](#T2)<br>
[Занесение результата тестирования в таблицу](#T3)<br>
[Запрос на добавление, занесение констант и данные из других таблиц JOIN](#T4)<br>
<br>

<a name="T1"></a>
# Задание

В таблицу attempt включить новую попытку для студента Баранова Павла по дисциплине «Основы баз данных». Установить текущую дату в качестве даты выполнения попытки.

Для того, чтобы вставить текущую дату используйте функцию NOW().

<img src="img/cx_4_3.jpg">

```sql
INSERT INTO attempt (student_id, subject_id, date_attempt) 
SELECT
    (SELECT student_id
    FROM student
    WHERE name_student = 'Баранов Павел'),
    (SELECT subject_id
     FROM subject
     WHERE name_subject = 'Основы баз данных'),
     NOW();
     
```

<a name="T2"></a>
### **Задание**
Случайным образом выбрать три вопроса по дисциплине, тестирование по которой собирается проходить студент, занесенный в таблицу `attempt` последним, и добавить их в таблицу `testing`. `id` последней попытки получить как максимальное значение `id` из таблицы `attempt`.

```sql
INSERT INTO testing (attempt_id, question_id)
SELECT attempt_id, question_id
FROM question 
	JOIN attempt USING(subject_id)
WHERE attempt_id = (SELECT MAX(attempt_id)
		    FROM attempt)
ORDER BY RAND()
LIMIT 3;
```

<a name="T2"></a>
### **Задание**

Студент прошел тестирование (то есть все его ответы занесены в таблицу testing), далее необходимо вычислить результат(запрос) и занести его в таблицу attempt для соответствующей попытки.  Результат попытки вычислить как количество правильных ответов, деленное на 3 (количество вопросов в каждой попытке) и умноженное на 100. Результат округлить до целого.

 Будем считать, что мы знаем id попытки,  для которой вычисляется результат, в нашем случае это 8. В таблицу testing занесены следующие ответы пользователя:

+------------+------------+-------------+-----------+
| testing_id | attempt_id | question_id | answer_id |
+------------+------------+-------------+-----------+
| 22         | 8          | 7           | 19        |
| 23         | 8          | 6           | 17        |
| 24         | 8          | 8           | 22        |
+------------+------------+-------------+-----------+

```sql
UPDATE attempt
SET result = (
	SELECT ROUND((SUM(is_correct) / 3) * 100)
	FROM answer a JOIN testing t ON a.answer_id = t.answer_id
    WHERE t.attempt_id = 8)

WHERE attempt_id = 8;

SELECT * FROM attempt;

+------------+------------+------------+--------------+--------+
| attempt_id | student_id | subject_id | date_attempt | result |
+------------+------------+------------+--------------+--------+
| 1          | 1          | 2          | 2020-03-23   | 67     |
| 2          | 3          | 1          | 2020-03-23   | 100    |
 .....................................
| 7          | 3          | 1          | 2020-05-17   | 33     |
| 8          | 1          | 2          | 2020-06-12   | 67     |
+------------+------------+------------+--------------+--------+
```


