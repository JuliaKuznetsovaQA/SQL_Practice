# База данных «Интернет-магазин книг», запросы корректировки

# Содержание
[Добавление записи в таблицу с использованием INSERT и SELECT](#T1)<br>
[Выбор 3 случайных вопросов для последнего студента. ORDER BY RAND()](#T2)<br>
[Занесение результата тестирования в таблицу](#T3)<br>
[Добавить студента и сданные 3 зачета на 100 в рандомные даты](#T4)<br>
<br>

<a name="T1"></a>
# Задание

В таблицу attempt включить новую попытку для студента Баранова Павла по дисциплине «Основы баз данных». Установить текущую дату в качестве даты выполнения попытки.

Для того, чтобы вставить текущую дату используйте функцию NOW().

<img src="img/cx_4_3.jpg">

```sql
INSERT INTO attempt (student_id, subject_id, date_attempt) 
SELECT
    (SELECT student_id
    FROM student
    WHERE name_student = 'Баранов Павел'),
    (SELECT subject_id
     FROM subject
     WHERE name_subject = 'Основы баз данных'),
     NOW();
     
```

<a name="T2"></a>
### **Задание**
Случайным образом выбрать три вопроса по дисциплине, тестирование по которой собирается проходить студент, занесенный в таблицу `attempt` последним, и добавить их в таблицу `testing`. `id` последней попытки получить как максимальное значение `id` из таблицы `attempt`.

```sql
INSERT INTO testing (attempt_id, question_id)
SELECT attempt_id, question_id
FROM question 
	JOIN attempt USING(subject_id)
WHERE attempt_id = (SELECT MAX(attempt_id)
		    FROM attempt)
ORDER BY RAND()
LIMIT 3;
```

<a name="T3"></a>
### **Задание**

Студент прошел тестирование (то есть все его ответы занесены в таблицу testing), далее необходимо вычислить результат(запрос) и занести его в таблицу attempt для соответствующей попытки.  Результат попытки вычислить как количество правильных ответов, деленное на 3 (количество вопросов в каждой попытке) и умноженное на 100. Результат округлить до целого.

 Будем считать, что мы знаем id попытки,  для которой вычисляется результат, в нашем случае это 8. В таблицу testing занесены следующие ответы пользователя:

```sql
+------------+------------+-------------+-----------+
| testing_id | attempt_id | question_id | answer_id |
+------------+------------+-------------+-----------+
| 22         | 8          | 7           | 19        |
| 23         | 8          | 6           | 17        |
| 24         | 8          | 8           | 22        |
+------------+------------+-------------+-----------+


UPDATE attempt
SET result = (
	SELECT ROUND((SUM(is_correct) / 3) * 100)
	FROM answer a JOIN testing t ON a.answer_id = t.answer_id
    WHERE t.attempt_id = 8)

WHERE attempt_id = 8;

SELECT * FROM attempt;

+------------+------------+------------+--------------+--------+
| attempt_id | student_id | subject_id | date_attempt | result |
+------------+------------+------------+--------------+--------+
| 1          | 1          | 2          | 2020-03-23   | 67     |
| 2          | 3          | 1          | 2020-03-23   | 100    |
 .....................................
| 7          | 3          | 1          | 2020-05-17   | 33     |
| 8          | 1          | 2          | 2020-06-12   | 67     |
+------------+------------+------------+--------------+--------+
```

<a name="T4"></a>
### **Задание из комментариев**

Вы - хакер, жадный до сертификатов степика. Вы увидели структуру базы данных и решили себе сразу так заполучить ещё три  сертификата. (Сдача теста на 100 балов означает для вас новый сертификат).
 Ваша задача:
1. Добавьте себя любимого (любимую) в таблицу студентов.
2. Вставьте в таблицу attempt:
 2.1  свой student_id,
 2.2  все три предмета  которые вы якобы сдали.
 2.3  случайную дату для каждой попытки, такую чтобы дата рассчитывалась как: (сегодняшний день - случайное число дней от 1 до 12) . К примеру, если сегодня 15 января, дата сдачи любого вашего теста была от 3 до 15 января, выбранная случайным образом. Ибо система распознает жуликов, которые получают все три сертификата в один день.
2.4 В результат воткните себе 100 балов, чтобы все ботаны, кавказцы и евреи  обзавидовались, а ваша мамка расцвела от гордости за своего ребёнка. 
Примечания:
п.2.2  - используйте функцию CROSS JOIN, вставляйте только SELECTOM вставлять словом values - ниже вашего достоинства.
п. 2.3 - вычитать дату можно функцией 

DATE_ADD(NOW(), interval -10 DAY) # вернет дату, которая была 10 дней назад

```sql

INSERT INTO student (name_student) VALUE ('Кузнецова Юлия');
SELECT * FROM student;

INSERT INTO attempt (student_id, subject_id, date_attempt, result)
SELECT 
	(SELECT student_id
	 FROM student
	 WHERE name_student = 'Кузнецова Юлия'),

	subject_id,

	DATE_ADD(NOW(), interval -FLOOR(RAND() * 12) DAY),

	100
FROM subject;

SELECT * FROM attempt;

+------------+-----------------+
| student_id | name_student    |
+------------+-----------------+
| 1          | Баранов Павел   |
| 2          | Абрамова Катя   |
| 3          | Семенов Иван    |
| 4          | Яковлева Галина |
| 5          | Кузнецова Юлия  |
+------------+-----------------+

+------------+------------+------------+--------------+--------+
| attempt_id | student_id | subject_id | date_attempt | result |
+------------+------------+------------+--------------+--------+
| 1          | 1          | 2          | 2020-03-23   | 67     |
| 2          | 3          | 1          | 2020-03-23   | 100    |
| 3          | 4          | 2          | 2020-03-26   | 0      |
| 4          | 1          | 1          | 2020-04-15   | 33     |
| 5          | 3          | 1          | 2020-04-15   | 67     |
| 6          | 4          | 2          | 2020-04-21   | 100    |
| 7          | 3          | 1          | 2020-05-17   | 33     |
| 8          | 5          | 1          | 2022-09-01   | 100    |
| 9          | 5          | 2          | 2022-08-28   | 100    |
| 10         | 5          | 3          | 2022-08-27   | 100    |
+------------+------------+------------+--------------+--------+

```
